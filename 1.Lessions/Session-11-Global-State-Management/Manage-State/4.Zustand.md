# State management v·ªõi Zustand

## Gi·ªõi thi·ªáu

![Zustand](https://github.com/pmndrs/zustand/raw/main/docs/bear.jpg)

Zustand l√† m·ªôt state management library nhanh v√† d·ªÖ d√†ng m·ªü r·ªông ƒëang ƒë∆∞·ª£c nhi·ªÅu ng∆∞·ªùi quan t√¢m hi·ªán nay. N√≥ ƒë∆∞·ª£c x√¢y d·ª±ng b·ªüi c√°c l·∫≠p tr√¨nh vi√™n ƒë√£ t·∫°o ra Jotai v√† React-springs. Zustand ƒë∆∞·ª£c bi·∫øt ƒë·∫øn b·ªüi t√≠nh ƒë∆°n gi·∫£n v√† s·ª≠ d·ª•ng hooks m√† kh√¥ng c·∫ßn theo m·ªôt ki·ªÉu m·∫´u nh·∫•t ƒë·ªãnh.

## T·∫°i sao c·∫ßn Qu·∫£n l√Ω Tr·∫°ng Th√°i To√†n C·∫ßu?

H√£y nh·ªõ l·∫°i v√≠ d·ª• v·ªÅ "prop drilling" v·ªõi `useContext`. `useContext` l√† m·ªôt gi·∫£i ph√°p t·ªët cho vi·ªác truy·ªÅn d·ªØ li·ªáu xu·ªëng d∆∞·ªõi c√¢y component. Tuy nhi√™n, n·∫øu b·∫°n c√≥:

* **Tr·∫°ng th√°i c·∫ßn ƒë∆∞·ª£c chia s·∫ª gi·ªØa c√°c component kh√¥ng c√≥ quan h·ªá cha-con tr·ª±c ti·∫øp (sibling components, ho·∫∑c component ·ªü c√°c nh√°nh c√¢y kh√°c nhau).**
* **Tr·∫°ng th√°i ph·ª©c t·∫°p c·∫ßn c·∫≠p nh·∫≠t th∆∞·ªùng xuy√™n t·ª´ nhi·ªÅu n∆°i.**
* **B·∫°n mu·ªën t√°ch bi·ªát logic tr·∫°ng th√°i ra kh·ªèi c√°c component UI ƒë·ªÉ d·ªÖ t√°i s·ª≠ d·ª•ng v√† ki·ªÉm th·ª≠.**

Trong nh·ªØng tr∆∞·ªùng h·ª£p n√†y, vi·ªác d√πng c√°c Hook nh∆∞ `useState` hay `useReducer` trong component c·ª•c b·ªô kh√¥ng c√≤n ph√π h·ª£p. C√°c th∆∞ vi·ªán qu·∫£n l√Ω tr·∫°ng th√°i to√†n c·∫ßu nh∆∞ Redux, MobX, Recoil, Jotai, v√† **Zustand** ƒë∆∞·ª£c sinh ra ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y.

**Zustand n·ªïi b·∫≠t v√¨:**

* **Si√™u nh·ªè g·ªçn:** K√≠ch th∆∞·ªõc bundle r·∫•t nh·ªè.
* **ƒê∆°n gi·∫£n:** API tr·ª±c quan v√† d·ªÖ h·ªçc, kh√¥ng c√≥ boilerplate (m√£ kh·ªüi t·∫°o) ph·ª©c t·∫°p.
* **Kh√¥ng c·∫ßn Context Provider:** Kh√¥ng gi·ªëng nh∆∞ Redux ho·∫∑c th·∫≠m ch√≠ `useContext`, b·∫°n kh√¥ng c·∫ßn bao b·ªçc ·ª©ng d·ª•ng c·ªßa m√¨nh b·∫±ng m·ªôt `Provider` c·∫•p cao nh·∫•t. C√°c store c·ªßa Zustand c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ·ªü b·∫•t c·ª© ƒë√¢u.
* **Hi·ªáu su·∫•t:** T·ªëi ∆∞u h√≥a vi·ªác re-render component ch·ªâ khi tr·∫°ng th√°i th·ª±c s·ª± thay ƒë·ªïi.

## üî• C√†i ƒë·∫∑t

```bash
npm install zustand
yarn add zustand
```

D√πng cho TypeScript: <https://github.com/pmndrs/zustand#typescript-usage>

## üî• C√°ch ho·∫°t ƒë·ªông c∆° b·∫£n c·ªßa Zustand

Zustand ho·∫°t ƒë·ªông d·ª±a tr√™n kh√°i ni·ªám **"store"**. M·ªôt store l√† n∆°i ch·ª©a tr·∫°ng th√°i to√†n c·ª•c c·ªßa b·∫°n v√† c√°c h√†m ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë√≥.

1. **T·∫°o m·ªôt store:** S·ª≠ d·ª•ng h√†m `create` t·ª´ `zustand`.
2. **ƒê·ªãnh nghƒ©a tr·∫°ng th√°i v√† c√°c h√†nh ƒë·ªông (actions) trong store.**
3. **S·ª≠ d·ª•ng store trong component:** D√πng Hook `useStore` (do `create` t·∫°o ra) ƒë·ªÉ l·∫•y tr·∫°ng th√°i ho·∫∑c c√°c h√†nh ƒë·ªông.

## üî• TaÃ£o m√¥Ã£t Store v∆°ÃÅi Zustand

```ts
import { create } from "zustand";

const useBearStore = create((set) => ({
  bears: 0,
  increasePopulation: () => set((state) => ({ bears: state.bears + 1 })),
  removeAllBears: () => set({ bears: 0 }),
}));
```

## üî• CaÃÅch ch√¢Ã£p nh√¢Ã£t State trong Zustand

```ts
import { create } from "zustand";

const useBearStore = create((set) => ({
  bears: 0,
  increasePopulation: () => set((state) => ({ bears: state.bears + 1 })),
  removeAllBears: () => set({ bears: 0 }),
}));
```

## üî• Truy c√¢Ã£p State trong Zustand

```ts
import { create } from "zustand";

const useBearStore = create((set, get) => ({
  bears: 0,
  increase: () => set({ bears: get().bears + 1 }),
}));
```

## üî• Async Action trong Zustand

```ts
const useFishStore = create((set) => ({
  fishies: {},
  fetch: async (pond) => {
    const response = await fetch(pond);
    set({ fishies: await response.json() });
  },
}));
```

---

## üî• L∆∞u tr∆∞ÃÉ State ƒë√™ÃÅn LocalStorage, SessionStorage v∆°ÃÅi Zustand

**Persist** gi√∫p b·∫°n l∆∞u tr·ªØ Zustand state xu·ªëng Storage (e.g., localStorage, AsyncStorage, IndexedDB, etc.)

```js
import { create } from "zustand";
import { persist, createJSONStorage } from "zustand/middleware";

const useFishStore = create(
  persist(
    (set, get) => ({
      fishes: 0,
      addAFish: () => set({ fishes: get().fishes + 1 }),
    }),
    {
      name: "food-storage", // name of the item in the storage (must be unique)
      storage: createJSONStorage(() => sessionStorage), // (optional) by default, 'localStorage' is used
    }
  )
);
```

Doc: <https://github.com/pmndrs/zustand/blob/main/docs/integrations/persisting-store-data.md>

Xem ·ªü ph·∫ßn v√≠ d·ª• t·∫°o gi·ªè h√†ng 2.Examples\Shopping-Cart-Zustand

---

## üî• Debug State trong Zustand

B∆∞∆°ÃÅc 1: CaÃÄi ƒëƒÉÃ£t [Redux DevTools Chrome extension](https://chromewebstore.google.com/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd)

B∆∞∆°ÃÅc 2: C√¢ÃÅu hiÃÄnh Store

```ts
import { create } from "zustand";
import { devtools, persist } from "zustand/middleware";
import type {} from "@redux-devtools/extension"; // required for devtools typing

interface BearState {
  bears: number;
  increase: (by: number) => void;
}

const useBearStore = create<BearState>()(
  devtools(
    persist(
      (set) => ({
        bears: 0,
        increase: (by) => set((state) => ({ bears: state.bears + by })),
      }),
      {
        name: "bear-storage",
      }
    )
  )
);
```

---

## üî• M√¥Ã£t s√¥ÃÅ viÃÅ duÃ£ v√™ÃÄ caÃÅch Zustand

### üî∑ bankSimple v·ªõi Zustand

B∆∞·ªõc 1: T·∫°o store

```js
// bankStore.js
import { create } from "zustand";

const useBankStore = create((set) => ({
  balance: 0,
  withdrawMoney: (amount) =>
    set((state) => ({ balance: state.balance - amount })),
  depositMoney: (amount) =>
    set((state) => ({ balance: state.balance + amount })),
}));

export default useBankStore;
```

B∆∞·ªõc 2: T√≠ch h·ª£p v√†o BankAccount Component

```js
// BankAccount.js
import React, { useState } from "react";
import useBankStore from "./bankStore";

const BankAccount = () => {
  const [amount, setAmount] = useState("");
  const balance = useBankStore((state) => state.balance);
  const withdrawMoney = useBankStore((state) => state.withdrawMoney);
  const depositMoney = useBankStore((state) => state.depositMoney);

  const handleWithdraw = () => {
    withdrawMoney(Number(amount));
    setAmount("");
  };

  const handleDeposit = () => {
    depositMoney(Number(amount));
    setAmount("");
  };

  return (
    <div>
      <h2>Balance: {balance}</h2>
      <div>
        <input
          type="number"
          value={amount}
          onChange={(e) => setAmount(e.target.value)}
        />
        <button onClick={handleWithdraw}>Withdraw</button>
        <button onClick={handleDeposit}>Deposit</button>
      </div>
    </div>
  );
};

export default BankAccount;
```

B∆∞·ªõc 3: Render ·ª©ng d·ª•ng

```js
// App.js
import React from "react";
import { Provider } from "react-redux";
import BankAccount from "./BankAccount";
import useBankStore from "./bankStore";

const App = () => {
  return (
    <Provider>
      <div>
        <h1>Simple Bank App</h1>
        <BankAccount />
      </div>
    </Provider>
  );
};

export default App;
```

C√∫ ph√°p v√† c√°ch s·ª≠ d·ª•ng Zustand kh√° t∆∞∆°ng ƒë·ªìng v·ªõi Redux, nh∆∞ng n√≥ c√≥ c√∫ ph√°p ng·∫Øn g·ªçn v√† d·ªÖ d√†ng s·ª≠ d·ª•ng h∆°n trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p ƒë∆°n gi·∫£n

### üî∑ V√≠ d·ª• v·ªÅ Call API

ƒê·ªÉ th·ª±c hi·ªán vi·ªác hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m, th√™m m·ªõi, x√≥a v√† c·∫≠p nh·∫≠t s·∫£n ph·∫©m s·ª≠ d·ª•ng Zustand v√† React, ch√∫ng ta s·∫Ω c·∫ßn t·∫°o m·ªôt store ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa c√°c s·∫£n ph·∫©m v√† c√°c h√†m ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c CRUD (Create, Read, Update, Delete). H√£y l√†m theo c√°c b∆∞·ªõc sau:

B∆∞·ªõc 1: C√†i ƒë·∫∑t Zustand v√† Axios (ƒë·ªÉ g·ªçi API)

ƒê·∫£m b·∫£o b·∫°n ƒë√£ c√†i ƒë·∫∑t Zustand v√† Axios b·∫±ng c√°ch ch·∫°y l·ªánh sau:

```bash
npm install zustand axios
# Ho·∫∑c s·ª≠ d·ª•ng yarn:
yarn add zustand axios
```

B∆∞·ªõc 2: T·∫°o Store v√† C√°c H√†m CRUD

```jsx
// store.js
import create from "zustand";
import axios from "axios";

const apiUrl = "https://api.escuelajs.co/api/v1/products";

const useProductStore = create((set) => ({
  products: [],
  isLoading: false,
  error: null, // Tr·∫°ng th√°i l∆∞u tr·ªØ th√¥ng b√°o l·ªói

  fetchProducts: async () => {
    try {
      set({ isLoading: true, error: null });
      const response = await axios.get(apiUrl);
      set({ products: response.data, isLoading: false });
    } catch (error) {
      console.error("Error fetching products:", error);
      set({ isLoading: false, error: "Error fetching products" });
    }
  },

  addProduct: async (newProduct) => {
    try {
      set({ isLoading: true, error: null });
      const response = await axios.post(apiUrl, newProduct);
      set((state) => ({
        products: [...state.products, response.data],
        isLoading: false,
      }));
    } catch (error) {
      console.error("Error adding product:", error);
      set({ isLoading: false, error: "Error adding product" });
    }
  },

  deleteProduct: async (productId) => {
    try {
      set({ isLoading: true, error: null });
      await axios.delete(`${apiUrl}/${productId}`);
      set((state) => ({
        products: state.products.filter((product) => product.id !== productId),
        isLoading: false,
      }));
    } catch (error) {
      console.error("Error deleting product:", error);
      set({ isLoading: false, error: "Error deleting product" });
    }
  },

  updateProduct: async (productId, updatedProduct) => {
    try {
      set({ isLoading: true, error: null });
      const response = await axios.put(
        `${apiUrl}/${productId}`,
        updatedProduct
      );
      set((state) => ({
        products: state.products.map((product) =>
          product.id === productId ? response.data : product
        ),
        isLoading: false,
      }));
    } catch (error) {
      console.error("Error updating product:", error);
      set({ isLoading: false, error: "Error updating product" });
    }
  },
}));

export default useProductStore;
```

Trong v√≠ d·ª• tr√™n, ch√∫ng ta ƒë√£ t·∫°o m·ªôt store c√≥ t√™n `useProductStore` ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i c·ªßa danh s√°ch s·∫£n ph·∫©m v√† c√°c h√†m ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c CRUD.

B∆∞·ªõc 3: S·ª≠ d·ª•ng Store trong Component

```jsx
// App.js
import React, { useEffect } from "react";
import useProductStore from "./store";

function App() {
  const products = useProductStore((state) => state.products);
  const fetchProducts = useProductStore((state) => state.fetchProducts);
  const addProduct = useProductStore((state) => state.addProduct);
  const deleteProduct = useProductStore((state) => state.deleteProduct);
  const updateProduct = useProductStore((state) => state.updateProduct);
  const updateProduct = useProductStore((state) => state.updateProduct);
  const isLoading = useProductStore((state) => state.isLoading);
  const error = useProductStore((state) => state.error);

  //C√≥ th·ªÉ r√∫t g·ªçn l·∫°i nh∆∞ sau:
  // const { products, isLoading, error, fetchProducts, addProduct, deleteProduct, updateProduct } = useProductStore();

  useEffect(() => {
    fetchProducts();
  }, [fetchProducts]);

  const handleAddProduct = async () => {
    const newProduct = {
      title: "New Product",
      price: 10,
      description: "A description",
      categoryId: 1,
      images: ["https://placeimg.com/640/480/any"],
    };
    await addProduct(newProduct);
  };

  const handleDeleteProduct = async (productId) => {
    await deleteProduct(productId);
  };

  const handleUpdateProduct = async (productId) => {
    const updatedProduct = {
      title: "Updated Product",
      price: 20,
      description: "An updated description",
      categoryId: 2,
      images: ["https://placeimg.com/640/480/any"],
    };
    await updateProduct(productId, updatedProduct);
  };

  return (
    <div>
      <h1>Product List</h1>
      {isLoading && <div>Loading...</div>}
      {error && <div>Error: {error}</div>}
      <ul>
        {products.map((product) => (
          <li key={product.id}>
            <strong>{product.title}</strong> - ${product.price}
            <button onClick={() => handleDeleteProduct(product.id)}>
              Delete
            </button>
            <button onClick={() => handleUpdateProduct(product.id)}>
              Update
            </button>
          </li>
        ))}
      </ul>
      <button onClick={handleAddProduct}>Add New Product</button>
    </div>
  );
}

export default App;
```

Trong v√≠ d·ª• tr√™n, ch√∫ng ta ƒë√£ s·ª≠ d·ª•ng store `useProductStore` v√† c√°c h√†m CRUD ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m, th√™m m·ªõi, x√≥a v√† c·∫≠p nh·∫≠t s·∫£n ph·∫©m. Khi ng∆∞·ªùi d√πng nh·∫•n n√∫t "Add New Product", "Delete" ho·∫∑c "Update" s·∫£n ph·∫©m, ch√∫ng ta s·∫Ω g·ªçi c√°c h√†m t∆∞∆°ng ·ª©ng t·ª´ store ƒë·ªÉ th·ª±c hi·ªán c√°c thao t√°c CRUD.

L∆∞u √Ω r·∫±ng, ƒë√¢y ch·ªâ l√† m·ªôt v√≠ d·ª• ƒë∆°n gi·∫£n ƒë·ªÉ minh h·ªça vi·ªác s·ª≠ d·ª•ng Zustand v·ªõi React ƒë·ªÉ qu·∫£n l√Ω tr·∫°ng th√°i v√† th·ª±c hi·ªán c√°c thao t√°c CRUD. Trong ·ª©ng d·ª•ng th·ª±c t·∫ø, b·∫°n c√≥ th·ªÉ c·∫ßn x·ª≠ l√Ω nhi·ªÅu tr∆∞·ªùng h·ª£p v√† ƒëi·ªÅu ki·ªán h∆°n.

### üî∑ Authentication and Authorization in React App

S·∫Ω c√≥ c√°c trang b·∫°n c·∫ßn y√™u c·∫ßu ƒëƒÉng nh·∫≠p ƒë√£ m·ªõi cho ph√©p truy c·∫≠p. Sau ƒë√¢y l√† c√°ch b·∫°n b·∫£o v·ªá c√°c Route c·∫ßn quy·ªÅn truy c·∫≠p nhu sau:

### Step 1 - C·∫•u h√¨nh Axios Client

T·∫°o file src/lib/axiosClient.ts v·ªõi n·ªôi dung sau:

```ts
import axios from "axios";
const API_URL = "https://api.escuelajs.co/api/v1/auth";

const axiosClient = axios.create({
  baseURL: API_URL,
  headers: {
    "Content-Type": "application/json",
  },
});

// REQUEST
axiosClient.interceptors.request.use(
  (config) => {
    const token = window.localStorage.getItem("token");
    if (token) {
      config.headers["Authorization"] = "Bearer " + token;
    }

    return config;
  },
  (error) => {
    Promise.reject(error);
  }
);

// RESPONSE

axiosClient.interceptors.response.use(
  async (response) => {
    const { access_token, refresh_token } = response.data;
    // LOGIN
    if (access_token) {
      window.localStorage.setItem("token", access_token);
    }
    if (refresh_token) {
      window.localStorage.setItem("refreshToken", refresh_token);
    }

    return response;
  },
  async (error) => {
    if (error?.response?.status !== 401) {
      return Promise.reject(error);
    }

    const originalConfig = error.config;

    if (error?.response?.status === 401 && !originalConfig.sent) {
      console.log("Error üöÄ", error);
      originalConfig.sent = true;
      try {
        // Tr∆∞·ªùng h·ª£p kh√¥ng c√≥ token th√¨ chuy·ªÉn sang trang LOGIN
        const token = window.localStorage.getItem("token");
        if (!token) {
          window.location.href = "/login";
          return Promise.reject(error);
        }

        const refreshToken = window.localStorage.getItem("refreshToken");
        if (refreshToken) {
          const response = await axiosClient.post("/refresh-token", {
            refreshToken: refreshToken,
          });

          const { access_token } = response.data;
          window.localStorage.setItem("token", access_token);

          originalConfig.headers = {
            ...originalConfig.headers,
            authorization: `Bearer ${access_token}`,
          };

          return axiosClient(originalConfig);
        } else {
          return Promise.reject(error);
        }
      } catch (err) {
        return Promise.reject(err);
      }
    }
  }
);

export { axiosClient };
```

### Step 2 - T·∫°o hook qu·∫£n l√Ω ƒëƒÉng nh·∫≠p v·ªõi zustand

T·∫°o file src/hooks/useAuth.ts

```ts
import { create } from "zustand";
import { axiosClient } from "../lib/axiosClient";

interface User {
  id: number;
  email: string;
  password: string;
  name: string;
  role: string;
  avatar: string;
}

interface Auth {
  user: User | null;
  setUser: (user: User) => void;
  isAuthenticated: boolean;
  login: (
    email: string,
    password: string
  ) => Promise<{ isAuthenticated: boolean; error: string }>;
  logout: () => void;
}

const useAuth = create<Auth>((set) => ({
  user: null,
  setUser: (user: User) => {
    set({ user });
  },
  isAuthenticated: false,
  login: async (email: string, password: string) => {
    try {
      //G·ªçi API Login
      const response = await axiosClient.post(
        "https://api.escuelajs.co/api/v1/auth/login",
        { email, password }
      );
      console.log(response);

      if (response && response.status === 201) {
        const isAuthenticated = response.status === 201;
        //G·ªçi ti·∫øp API l·∫•y th√¥ng tin User
        const { data } = await axiosClient.get(
          "https://api.escuelajs.co/api/v1/auth/profile"
        );
        set({ user: data, isAuthenticated });
        //Tr·∫£ v·ªÅ d·∫•u hi·ªáu ƒë·ªÉ components chuy·ªÉn h∆∞·ªõng sau khi login OK
        return { isAuthenticated, error: "" };
      } else {
        return {
          isAuthenticated: false,
          error: "Username or password is invalid",
        };
      }
    } catch (error) {
      return {
        isAuthenticated: false,
        error: error?.message || "Login failed",
      };
    }
  },
  logout: () => {
    // X√≥a tr·∫°ng th√°i user v√† isAuthenticated
    set({ user: null, isAuthenticated: false });
    localStorage.removeItem("token");
    localStorage.removeItem("refreshToken");
  },
}));

export default useAuth;
```

L∆∞u √Ω:

* API_URL: Thay ƒë·ªïi url API ƒë√∫ng v·ªõi backend API
* Thay ƒë·ªïi c√°c endpoints ƒë√∫ng v·ªõi backend API c·ªßa b·∫°n

### Step 3 - Login

Code ph·∫ßn login

```tsx
import React from "react";
import { useForm } from "react-hook-form";
import { yupResolver } from "@hookform/resolvers/yup";
import * as yup from "yup";
import { useNavigate } from "react-router-dom";
import useAuth from "../../hooks/useAuth";

const schema = yup
  .object({
    email: yup.string().email().required(),
    password: yup.string().required(),
  })
  .required();
type FormData = yup.InferType<typeof schema>;

const LoginAPI = () => {
  const navigate = useNavigate();
  const { login } = useAuth();
  const [error, setError] = React.useState<string | null>(null);
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<FormData>({
    resolver: yupResolver(schema),
  });
  const onSubmit = async (data: FormData) => {
    console.log(data);
    const result = await login(data.email, data.password);
    console.log(result);
    if (result.isAuthenticated) {
      navigate("/customers");
    } else {
      setError(result.error);
    }
  };

  return (
    <div className="max-w-[300px] mx-auto min-w-[300px]">
      <h2 className="text-2xl text-center mb-3 font-bold">Login Form</h2>
      {error && <div>Error: {error}</div>}
      <form onSubmit={handleSubmit(onSubmit)}>
        <input placeholder="Email" {...register("email")} />
        <p>{errors.email?.message}</p>

        <input placeholder="password" {...register("password")} />
        <p>{errors.password?.message}</p>

        <button className="block w-full" disabled={isSubmitting} type="submit">
          {isSubmitting ? "Submitting..." : "Login"}
        </button>
      </form>
    </div>
  );
};

export default LoginAPI;
```

### Step 4 - B·∫£o v·ªá c√°c trang c·∫ßn quy·ªÅn Login

V√≠ d·ª•:

|-/ home page --> public
|-/login login page --> public
|-/customer customer page --> private
|-/customer/orders customer page --> private
|-/customer/profile customer page --> private

Th√¨ b·∫°n l·ªìng c√°c route private l·∫°i trong m·ªôt Layout chung ki·ªÉu nh∆∞

```tsx
<Route path="customer" element="Customer">
  <Route path="orders" element="CustomerOrders" />
  <Route path="profile" element="CustomerProfile" />
</Route>
```

Sau ƒë√≥ t·∫°i `Customer` b·∫°n check xem user ƒë√£ ƒëƒÉng nh·∫≠p ch∆∞a b·∫±ng c√°ch truy c·∫≠p v√†o state `user` t·ª´ useAuth

```tsx
import React from "react";
import { Outlet, Link } from "react-router-dom";
import useAuth from "../../hooks/useAuth";
import { useNavigate } from "react-router-dom";
1;
const Customers = () => {
  const { isAuthenticated, logout } = useAuth();
  const navigate = useNavigate();
  React.useEffect(() => {
    if (!isAuthenticated) {
      navigate("/login");
    }
  }, [isAuthenticated]);

  return (
    <>
      <h1 className="py-5">Customers Page</h1>
      <div className="grid grid-cols-12">
        <div className="col-span-4">
          <ul>
            <li>
              <Link to={"/customers"}>Dashboard</Link>
            </li>
            <li>
              <Link to={"/customers/orders"}>Danh s√°ch ƒë∆°n h√†ng</Link>
            </li>
            <li>
              <Link to={"/customers/profile"}>Th√¥ng tin c√° nh√¢n</Link>
            </li>
            <li>
              <button type="button" onClick={logout}>
                ƒêƒÉng Xu·∫•t
              </button>
            </li>
          </ul>
        </div>
        <div className="col-span-8">
          <Outlet />
        </div>
      </div>
    </>
  );
};

export default Customers;
```

### Step 5 - L·∫•y th√¥ng tin User ƒë∆∞a l√™n Header

Component UserInfo

```tsx
import useAuth from "../../hooks/useAuth";
import { Link } from "react-router-dom";

const UserInfo = () => {
  const { user, logout } = useAuth();

  return (
    <span>
      {user ? (
        <span className="flex gap-x-2 items-center">
          <img
            className="rounded-full"
            width={30}
            height={30}
            src={user.avatar}
            alt={user.name}
          />
          <strong>{user.name}</strong>
          <span
            className="cursor-pointer border-s border-slate-900 pl-2"
            onClick={logout}
          >
            ƒêƒÉng xu·∫•t
          </span>
        </span>
      ) : (
        <Link to={"/login"}>Login</Link>
      )}
    </span>
  );
};

export default UserInfo;
```

Tham kh·∫£o th√™m 2 b√†i vi·∫øt sau:

* <https://www.robinwieruch.de/react-router-private-routes/>
* <https://ui.dev/react-router-protected-routes-authentication>
